app-id: xyz.fontra.FontraPak
runtime: org.kde.Platform
runtime-version: '6.5'
sdk: org.kde.Sdk
command: fontra-pak

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --filesystem=home
  - --share=network
  - --device=dri

add-extensions:
  org.kde.PyQt6:
    directory: lib/python3.10/site-packages
    add-ld-path: lib

build-options:
  env:
    PYTHON_PATH: /app/lib/python3.10/site-packages

modules:
  - name: python3-pip
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app pip
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/py3/p/pip/pip-23.3.1-py3-none-any.whl
        sha256: 55eb67bb6171d37447e82213be585b75fe2b12b359e993773aca4de9247a052b

  # Git dependencies as separate modules
  - name: fontra
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app .
    sources:
      - type: git
        url: https://github.com/googlefonts/fontra.git
        branch: main

  - name: fontra-compile
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app .
    sources:
      - type: git
        url: https://github.com/googlefonts/fontra-compile.git
        branch: main

  - name: fontra-rcjk
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app .
    sources:
      - type: git
        url: https://github.com/googlefonts/fontra-rcjk.git
        branch: main

  - name: fontra-glyphs
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app .
    sources:
      - type: git
        url: https://github.com/googlefonts/fontra-glyphs.git
        branch: main

  - name: delocate
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app .
    sources:
      - type: git
        url: https://github.com/justvanrossum/delocate.git
        branch: master

  # PyPI dependencies
  - name: python3-aiohttp
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app aiohttp==3.12.13
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/source/a/aiohttp/aiohttp-3.12.13.tar.gz
        sha256: 47e2da578528264a12e4e3dd8dd72a7289e5f812758fe086473fab037a10fcce

  - name: python3-setuptools
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app setuptools==80.8.0
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/source/s/setuptools/setuptools-80.8.0.tar.gz
        sha256: 49f7af965996f26d43c8ae34539c8d99c5042fbff34302ea151eaa9c207cd257

  - name: python3-pyqt6
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app PyQt6==6.7.1
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/source/P/PyQt6/PyQt6-6.7.1.tar.gz
        sha256: 3672a82ccd3a62e99ab200a13903421e2928e399fda25ced98d140313ad59cb9

  - name: python3-pyqt6-qt6
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app PyQt6-Qt6==6.7.3
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/source/P/PyQt6-Qt6/PyQt6_Qt6-6.7.3-py3-none-manylinux_2_28_x86_64.whl
        sha256: cb525fdd393332de60887953029276a44de480fce1d785251ae639580f5e7246

  - name: python3-pyqt6-sip
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app PyQt6-sip==13.10.2
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/source/P/PyQt6-sip/PyQt6_sip-13.10.2.tar.gz
        sha256: 464ad156bf526500ce6bd05cac7a82280af6309974d816739b4a9a627156fafe

  - name: python3-pyinstaller
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app pyinstaller==6.14.1
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/source/p/pyinstaller/pyinstaller-6.14.1.tar.gz
        sha256: 35d5c06a668e21f0122178dbf20e40fd21012dc8f6170042af6050c4e7b3edca
    cleanup:
      - /include
      - /lib/pkgconfig

  - name: fontra-pak
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app .
      - pyinstaller FontraPak.spec -y --distpath=/app/bin
    sources:
      - type: git
        url: https://github.com/mitradranirban/fontrapak-flatpak

cleanup:
  - /include
  - /lib/pkgconfig
  - '*.la'
  - '*.a'
  - /lib/python3.10/site-packages/PyInstaller/bootloader/Windows-64bit
  - /lib/python3.10/site-packages/PyInstaller/bootloader/Windows-32bit
  - /lib/python3.10/site-packages/PyInstaller/bootloader/Darwin-64bit
