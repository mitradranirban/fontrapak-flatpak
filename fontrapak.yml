app-id: xyz.fontra.FontraPak
runtime: org.kde.Platform
runtime-version: '6.5'
sdk: org.kde.Sdk
command: fontra-pak
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --filesystem=home
  - --share=network
  - --device=dri
build-options:
  env:
    PYTHON_PATH: /app/lib/python3.10/site-packages

modules:
  - name: python3-PyQt6
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app PyQt6
    cleanup:
      - /include
      - /lib/pkgconfig
      - '*.la'
      - '*.a'

  - name: python3-pyinstaller
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app pyinstaller
    cleanup:
      - /include
      - /lib/pkgconfig

  - name: fontra-pak
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app .
      - pyinstaller FontraPak.spec -y --distpath=/app/bin
    sources:
      - type: git
        url: https://github.com/mitradranirban/fontra-pak.
        branch: flatpak-maker
    modules:
      - name: python3-pip
        buildsystem: simple
        build-commands:
          - pip3 install --prefix=/app pip
        sources:
          - type: file
            url: https://files.pythonhosted.org/packages/py3/p/pip/pip-23.3.1-py3-none-any.whl
            sha256: 55eb67bb6171d37447e82213be585b75fe2b12b359e993773aca4de9247a052b
      - name: python3-requirements
        buildsystem: simple
        build-commands:
          - pip3 install --prefix=/app -r requirements.txt
        sources:
          - type: file
            path: requirements.txt

cleanup:
  - /include
  - /lib/pkgconfig
  - '*.la'
  - '*.a'
  - /lib/python3.10/site-packages/PyInstaller/bootloader/Windows-64bit
  - /lib/python3.10/site-packages/PyInstaller/bootloader/Windows-32bit
  - /lib/python3.10/site-packages/PyInstaller/bootloader/Darwin-64bit
